# Установка на Windows

Для работы с NASM нам надо установить непосредственно сам ассемблер. Для этого на официальном сайте перейдем на страницу https://www.nasm.us/pub/nasm/releasebuilds/2.16.01/win64/, где находятся файлы ассемблера NASM версии 2.16.01 для 64-разрядной версии Windows:

![image](https://github.com/user-attachments/assets/1614c583-d14b-4474-a3ee-0f4e98815c3e)

Здесь нам доступен ассемблер в виде двух пакетов. Один пакет установщика (nasm-2.16.01-installer-x64.exe), а второй - архив (nasm-2.16.01-win64.zip). Загрузим zip-архив.. Например, загрузим zip-архив и после загрузки распакуем его. В папке распакованного архива мы можем найти два файла

![image](https://github.com/user-attachments/assets/6944bac2-9538-4f42-a27a-67017f581d87)

Это прежде всего сам ассемблер - файл nasm.exe и дизассемблер - файл ndisasm.exe

Чтобы не прописывать весь путь к ассемблеру, занесем его в переменные среды. Для этого можно в окне поиска в Windows ввести "изменение переменных среды текущего пользователя":

![image](https://github.com/user-attachments/assets/03989eb5-48f6-4f0c-87df-3e6f05cd99f4)

Нам откроется окно Переменныех среды:

![image](https://github.com/user-attachments/assets/0ddc1a07-be1b-46bd-b002-a977ff2c0253)

И добавим путь к ассемблеру. Например, в моем случае архив ассемблера распакован в папку C:\nasm-2.16.01, соответственно я указываю в переменной Path среды эту папку:

![image](https://github.com/user-attachments/assets/61b3e998-9b31-458d-9e34-7b76895d62e5)

Если все настроено правильно, то мы можем запустить командную строку и с помощью команды nasm -v узнать текущую версию ассемблера:

```
C:\Users\eugen>nasm -v
NASM version 2.16.01 compiled on Dec 21 2022

C:\Users\eugen>
```

Компиляция

Для компиляции откроем командную строку, перейдем в ней к папке с исходным кодом (где располагается файл hello.asm) и выполним следующую команду

```
nasm -f win64 hello.asm -o hello.o
```

Здесь с помощью опции -f указывается формат файла, в который мы хотим скомпилировать код. Для 64-разрядной ОС Windows это - win64. После этого указывается файл, который мы хотим скомпилировать - наш файл hello.asm. Затем опция -o hello.o указывает на имя скомпилированного файла. В результате выполнения этой команды будет создан объектный файл hello.o

Однако файл hello.o - это объектный файл, а не исполняемый. Он содержит машинный код, который понимает компьютер, но чтобы его можно было запускать как обычную программу, его надо скомпоновать в исполняемый файл. И для этого нужна программа компоновщика (он же линковщик/линкер или linker). Недостатком NASM является то, что он не предоставляет встроенного компоновщика. И нам надо использовать внешнюю программу компоновки. Где ее взять? Далее я рассмотрю два варианта - использование компоновщика из пакета GCC и использование компоновщика компилятора Visual C/C++, который идет вместе с Visual Studio. Оба варианта равноценны.

Компоновка с помощью GCC

Вначале нам надо установить пакет GCC. Пакет компиляторов GCC для Windows не имеет какого-то одного единого разработчика, разные организации могут выпускать свои сборки. Для Windows одной из наиболее популярных версий GCC является пакет средств для разработки от некоммерческого проекта MSYS2. Следует отметить, что для MSYS2 требуется 64-битная версия Windows 7 и выше (то есть Vista, XP и более ранние версии не подходят)

Итак, загрузим программу установки MSYS2 с официального сайта MSYS2:

![image](https://github.com/user-attachments/assets/03734fa5-ca72-4ac3-a909-df780396bc7d)

После загрузки запустим программу установки:

![image](https://github.com/user-attachments/assets/5bf2c85b-0fba-4e36-bbd5-2f1916497b77)

На первом шаге установки будет предложено установить каталог для установки. По умолчанию это каталог C:\msys64:

![image](https://github.com/user-attachments/assets/cdb74da9-fa0c-410f-ac95-c127f036e3eb)

Оставим каталог установки по умолчанию (при желании можно изменить). На следующем шаге устанавливаются настройки для ярлыка для меню Пуск, и затем собственно будет произведена установка. После завершения установки нам отобразить финальное окно, в котором нажмем на кнопку Завершить

![image](https://github.com/user-attachments/assets/0b8f33e9-e94a-4672-9699-9a9cfb8690a1)

После завершения установки запустится консольное приложение MSYS2.exe. Если по каким-то причинам оно не запустилось, то в папке установки C:/msys64 надо найти файл usrt_64.exe:

![image](https://github.com/user-attachments/assets/cf89258d-c1c7-4a12-a46f-e1093fbde469)

Теперь нам надо установить собственно набор компиляторов GCC. Для этого введем в этом приложении следующую команду:

```
pacman -S mingw-w64-ucrt-x86_64-gcc
```

Для управления пакетами MSYS2 использует пакетный менеджер Packman. И данная команда говорит пакетному менелжеру packman установить пакет mingw-w64-ucrt-x86_64-gcc, который представляет набор компиляторов GCC (название устанавливаемого пакета указывается после параметра -S).

![image](https://github.com/user-attachments/assets/f40751b1-2352-4f7a-a7bb-b1544647a895)

Если после завершения установки мы откроем каталог установки и зайдем в нем в папку C:\msys64\ucrt64\bin, то найдем там файл компоновщика ld

![image](https://github.com/user-attachments/assets/9b079a50-07ed-4d3c-9497-1ce5754f7fec)

Для упрощения запуска компоновщика мы можем добавить путь к нему в Переменные среды:

![image](https://github.com/user-attachments/assets/d92ff954-582a-4b25-8713-d95012c04aa5)

Чтобы убедиться, что нам доступен компоновщик GCC - программа ld, введем следующую команду:

```
ld --version
```

В этом случае нам должна отобразиться версия компоновщика

```
c:\asm>ld --version
GNU ld (GNU Binutils) 2.40
Copyright (C) 2023 Free Software Foundation, Inc.
This program is free software; you may redistribute it under the terms of
the GNU General Public License version 3 or (at your option) a later version.
This program has absolutely no warranty.

c:\asm>
```

Теперь скомпонуем файл hello.o в исполняемый файл hello.exe с помощью следующей команды:

```
ld hello.o -o hello.exe
```

Мы можем запустить этот файл, введя в консоли его название и нажав на Enter. Но наша программа ничего не выводит на консоль, поэтому после запуска программы мы ничего не увидим. Тем не менее наша программа устанавливает регистр RAX. А значение этого регистра при завершении программы рассматривается в Windows как статусный код возврата, который сигнализирует, как завершилась программа (успешно или не успешно). И мы можем этот статусный код получить, если после выполнения программы введем команду

```
echo %ERRORLEVEL%
```

И нам должно отобразится число 22 - значение регистра RAX. Полный консольный вывод:

```
c:\asm>nasm -f win64 hello.asm -o hello.o

c:\asm>ld hello.o -o hello.exe

c:\asm>hello.exe

c:\asm>echo %ERRORLEVEL%
22

c:\asm>
```

